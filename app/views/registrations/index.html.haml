%h1 Registration form

%h2.page-header Personal informations
%input
%h2.page-header Faculties
- Openday.first.openday_faculties.each do |faculty|
  %h3-faculty.faculty.name
  - faculty.openday_programmes.each do |programme|
    %input.time_enable{id: 'programme'+programme.id.to_s+'-enable', type: 'checkbox', 'programme' => 'programme'+programme.id.to_s}
    %span.page-header=programme.programme.name
    %div{id: 'programme'+programme.id.to_s+'-block'}
      - programme.openday_timeslots.each do |timeslot|
        %input.time{id: 'timeslot['+timeslot.id.to_s+']', value: '1', type: 'radio', 'time_from' => timeslot.time_from.strftime('%H%M'), 'time_till' => timeslot.time_till.strftime('%H%M'), name: 'programme'+programme.id.to_s}
        %label{for: 'timeslot['+timeslot.id.to_s+']'}
          ="#{timeslot.time_from.strftime('%H:%M')} - #{timeslot.time_till.strftime('%H:%M')}"
        %input{type: "hidden", id: "programme"+programme.id.to_s+"-previous"}

        %br

:javascript
  var clicks = new Array();

  $("input.time_enable").click(function () {
    if ($(this).prop("checked") == false) {
      programme_name = $(this).attr("programme");
      block_name = programme_name + "-block";
      prev = programme_name + "-previous"
      $('#' + block_name + ' :input').prop('checked', false);;
      
      oldvalue = $('#' + prev).attr('value');
      dropTime(oldvalue);
      reloadTimes();   
    }
  });
  
  $("input.time").click(function () {
      btn = $(this);
      from = btn.attr('time_from');
      till = btn.attr('time_till');
  
      enable = $(this).attr("name") + "-enable"
      $('#' + enable).prop('checked', true);;
      prev = $(this).attr("name") + "-previous"
      oldvalue = $('#' + prev).attr('value');
      
      dropTime(oldvalue);
  
      newvalue = from + '-' + till;
      clicks.push(newvalue);
      $('#' + prev).attr('value', newvalue);
  
      reloadTimes();
  });
  
  function reloadTimes() {
    $("input.time").each(function (index) {
          $(this).prop("disabled", false);;
      });
  
      $.each(clicks, function (index, value) {
          time = (value.split("-"));
          diableTimeslots(time[0], time[1]);
      });
  
      $("input:checked").each(function (index) {
          $(this).prop("disabled", false);
      });   
  }
  
  function diableTimeslots(from, till) {
    $("input.time").each(function (index) {
      if ((from <= $(this).attr('time_from') && $(this).attr('time_from') <= till)       || (from <= $(this).attr('time_till') && $(this).attr('time_till') <= till))       {
          $(this).prop("disabled", true);
      }
    });
  }
  
  function dropTime(time) {
      index = $.inArray(time, clicks);
      if (index > -1) {
          clicks.splice(index, 1);
      }
  }      