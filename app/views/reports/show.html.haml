%h1= t('report.for', name: @openday.name)

%h4
  %b=t('report.total_registrants', name: @openday.name )
  =@openday.registrants.count

%h4
  %b=t('report.total_registrations', name: @openday.name )
  =@openday.registrations.count

%h3.page-header=t('report.registrants_chart.title')
#container_chart_1{style: "min-width: 310px; height: 400px; margin: 0 auto"}

%h3.page-header=t('report.registrations_chart.title')
#container_chart_2{style: "min-width: 310px; height: 400px; margin: 0 auto"}

- reg_timerange = ''
- @openday_range.each do |val|
  - reg_timerange += "'#{val}',"

- reg_total = ''
- total = 0
- @openday_registrations.each do |val|
  - unless val.nil?
    - total = val+total
    - reg_total += "#{total},"
  - else
    - reg_total += "null,"


- registrations_list = ''
- @faculty_registrations.each do |key, list|
  - total = 0
  - list_string = "{name: '#{OpendayFaculty.find(key).faculty.name}', data: ["
  - list.each do |val|
    - unless val.nil?
      - total = val+total
      - list_string += "#{total},"
    - else
      - list_string += "null,"
  - list_string += ']},'
  - registrations_list += list_string

- country_list = ""
- country_count = 0
- other_count = 0
- @openday_countries.each do |country, counts, index|
  - if counts.to_i>0
    - unless country_count >= CONFIG['reports']['pie_countries']
      - country_list += "[\"#{Country[country].name}\", #{counts}],"
      - country_count +=1
    - else
      - other_count += counts


- country_list += "['#{t('report.other_countries')}', #{other_count}]"

%h3.page-header=t('report.registrations_pie.title')
#container_pie_1{style: "min-width: 310px; height: 400px; margin: 0 auto"}
%table.table.table-hover
  %tr
    %th=t('report.country_name')
    %th=t('report.country_count')
    %th=t('report.country_percent')
  - @openday_countries.each do |country, count|
    - unless count < 1
      %tr
        %td=Country[country].name
        %td=count.to_s
        %td="#{((count.to_f/@openday.registrants.count.to_f)*100).round(2)}%"

  
:javascript
  $(function () {
    $('#container_chart_1').highcharts({
      chart: {
             type: 'spline',
             zoomType: 'x',
             spacingRight: 20
            },
      title: {
        text: null,
      },
      xAxis: {
        maxZoom: 10,
        categories: [
          #{reg_timerange}
      ]},
      yAxis: {
        min: 0,
        title: {
          text: '#{t('report.registrants_chart.y_axis')}'
        },
      },
      legend: {
        layout: 'vertical',
        align: 'right',
        verticalAlign: 'middle',
        borderWidth: 0
      },
      plotOptions: {
        spline: {
          marker: {
            enabled: false
          }
        }
      },
      series: [{
        name: '#{@openday.name}',
        data: [
          #{reg_total}
      ]}]
    });
  });

  $(function () {
    $('#container_chart_2').highcharts({
      chart: {
             type: 'spline',
             zoomType: 'x',
             spacingRight: 20
            },
      title: {
        text: null,
      },
      xAxis: {
        maxZoom: 10,
        categories: [
          #{reg_timerange}
      ]},
      yAxis: {
        min: 0,
        title: {
          text: '#{t('report.registrations_chart.y_axis')}'
        },
      },
      legend: {
        layout: 'vertical',
        align: 'right',
        verticalAlign: 'middle',
        borderWidth: 0
      },
      plotOptions: {
        spline: {
          marker: {
            enabled: false
          }
        }
      },
      series: [
        #{registrations_list}
      ]
    });
  });

  $(function () {
    $('#container_pie_1').highcharts({
      chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false
      },
      title: {
        text: null
      },
      tooltip: {
       pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
      },
      plotOptions: {
        pie: {
          allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
              enabled: true,
              color: '#000000',
              connectorColor: '#000000',
              format: '<b>{point.name}</b>: {point.percentage:.1f} %'
            }
          }
        },
        series: [{
          type: 'pie',
          name: 'Browser share',
          data: [
                #{country_list}
            ]
        }]
    });
  });